<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_10) on Mon Jan 28 23:07:11 CST 2013 -->
<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
<title>ShardedEngineBase</title>
<meta name="date" content="2013-01-28">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ShardedEngineBase";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ShardedEngineBase.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/xflatdb/xflat/db/IntegerIdGenerator.html" title="class in org.xflatdb.xflat.db"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/xflatdb/xflat/db/TableBase.html" title="class in org.xflatdb.xflat.db"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/xflatdb/xflat/db/ShardedEngineBase.html" target="_top">Frames</a></li>
<li><a href="ShardedEngineBase.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_classes_inherited_from_class_org.xflatdb.xflat.db.EngineBase">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.xflatdb.xflat.db</div>
<h2 title="Class ShardedEngineBase" class="title">Class ShardedEngineBase&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">org.xflatdb.xflat.db.EngineBase</a></li>
<li>
<ul class="inheritance">
<li>org.xflatdb.xflat.db.ShardedEngineBase&lt;T&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="../../../../org/xflatdb/xflat/db/Engine.html" title="interface in org.xflatdb.xflat.db">Engine</a></dd>
</dl>
<dl>
<dt>Direct Known Subclasses:</dt>
<dd><a href="../../../../org/xflatdb/xflat/engine/IdShardedEngine.html" title="class in org.xflatdb.xflat.engine">IdShardedEngine</a></dd>
</dl>
<hr>
<br>
<pre>public abstract class <span class="strong">ShardedEngineBase&lt;T&gt;</span>
extends <a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></pre>
<div class="block">The base class for all engines that are sharded.  Sharded engines store the table
 data across multiple files.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested_classes_inherited_from_class_org.xflatdb.xflat.db.EngineBase">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from class&nbsp;org.xflatdb.xflat.db.<a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></h3>
<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.Row.html" title="class in org.xflatdb.xflat.db">EngineBase.Row</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.RowData.html" title="class in org.xflatdb.xflat.db">EngineBase.RowData</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.SpinDownEvent.html" title="class in org.xflatdb.xflat.db">EngineBase.SpinDownEvent</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.SpinDownEventHandler.html" title="interface in org.xflatdb.xflat.db">EngineBase.SpinDownEventHandler</a></code></li>
</ul>
</li>
</ul>
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../../org/xflatdb/xflat/ShardsetConfig.html" title="class in org.xflatdb.xflat">ShardsetConfig</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#config">config</a></strong></code>
<div class="block">The configuration of this sharded table.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.io.File</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#directory">directory</a></strong></code>
<div class="block">The directory managed by this sharded engine.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.util.concurrent.ConcurrentMap&lt;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;,java.io.File&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#knownShards">knownShards</a></strong></code>
<div class="block">The shards that are known to exist on disk.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected java.util.concurrent.ConcurrentMap&lt;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;,<a href="../../../../org/xflatdb/xflat/db/TableMetadata.html" title="class in org.xflatdb.xflat.db">TableMetadata</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#openShards">openShards</a></strong></code>
<div class="block">The shards that are currently open and ready to use.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields_inherited_from_class_org.xflatdb.xflat.db.EngineBase">
<!--   -->
</a>
<h3>Fields inherited from class&nbsp;org.xflatdb.xflat.db.<a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></h3>
<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#log">log</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#state">state</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier</th>
<th class="colLast" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected </code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#ShardedEngineBase(java.io.File, java.lang.String, org.xflatdb.xflat.ShardsetConfig)">ShardedEngineBase</a></strong>(java.io.File&nbsp;file,
                 java.lang.String&nbsp;tableName,
                 <a href="../../../../org/xflatdb/xflat/ShardsetConfig.html" title="class in org.xflatdb.xflat">ShardsetConfig</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;config)</code>
<div class="block">Creates a new ShardedEngine for the given directory, table name, and configuration</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#beginOperations()">beginOperations</a></strong>()</code>
<div class="block">Instructs the engine to begin full read/write operations.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected &lt;U&gt;&nbsp;U</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#doWithEngine(org.xflatdb.xflat.query.Interval, org.xflatdb.xflat.db.EngineAction)">doWithEngine</a></strong>(<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;range,
            <a href="../../../../org/xflatdb/xflat/db/EngineAction.html" title="interface in org.xflatdb.xflat.db">EngineAction</a>&lt;U&gt;&nbsp;action)</code>
<div class="block">Performs an action with the appropriate engine for the given shard interval.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#forceSpinDown()">forceSpinDown</a></strong>()</code>
<div class="block">Forces this engine to immediately release all resources, even if there are
 still outstanding cursors or uncommitted data.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#getInterval(java.lang.Object)">getInterval</a></strong>(java.lang.Object&nbsp;value)</code>
<div class="block">Gets the interval in which the given selected shard property should reside,
 based on the IntervalProvider given in the configuration.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected <a href="../../../../org/xflatdb/xflat/db/TableMetadataFactory.html" title="class in org.xflatdb.xflat.db">TableMetadataFactory</a></code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#getMetadataFactory()">getMetadataFactory</a></strong>()</code>
<div class="block">Gets a metadata factory which can be used to generate <a href="../../../../org/xflatdb/xflat/db/TableMetadata.html" title="class in org.xflatdb.xflat.db"><code>TableMetadata</code></a> objects.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected <a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#getRangeForRow(org.jdom2.Element)">getRangeForRow</a></strong>(org.jdom2.Element&nbsp;row)</code>
<div class="block">Gets the interval in which the row should reside, based on the shard property
 selector in the configuration.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#hasUncomittedData()">hasUncomittedData</a></strong>()</code>
<div class="block">Returns true if any of the individual shards have uncommitted data.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#isSpunDown()">isSpunDown</a></strong>()</code>
<div class="block">Invoked in a synchronized context to see if the sharded engine is 
 fully spun down.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#revert(long, boolean)">revert</a></strong>(long&nbsp;txId,
      boolean&nbsp;isRecovering)</code>
<div class="block">Reverts the given transaction.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#setMetadataFactory(org.xflatdb.xflat.db.TableMetadataFactory)">setMetadataFactory</a></strong>(<a href="../../../../org/xflatdb/xflat/db/TableMetadataFactory.html" title="class in org.xflatdb.xflat.db">TableMetadataFactory</a>&nbsp;metadataFactory)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#spinDown(org.xflatdb.xflat.db.EngineBase.SpinDownEventHandler)">spinDown</a></strong>(<a href="../../../../org/xflatdb/xflat/db/EngineBase.SpinDownEventHandler.html" title="interface in org.xflatdb.xflat.db">EngineBase.SpinDownEventHandler</a>&nbsp;completionEventHandler)</code>
<div class="block">Instructs this Engine to wrap up its operations in preparation for being
 switched out.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>protected boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#spinUp()">spinUp</a></strong>()</code>
<div class="block">Initializes the engine and instructs it to begin acquiring the resources
 necessary to function.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#updateTask()">updateTask</a></strong>()</code>
<div class="block">Executed by the recurring update task every 500 ms in order to clean up
 the shardset and spin down any inactive shards.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_org.xflatdb.xflat.db.EngineBase">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;org.xflatdb.xflat.db.<a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></h3>
<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#commit(org.xflatdb.xflat.transaction.Transaction)">commit</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#ensureWriteReady()">ensureWriteReady</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getConversionService()">getConversionService</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getExecutorService()">getExecutorService</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getId(org.jdom2.Element)">getId</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getLastActivity()">getLastActivity</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getState()">getState</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getTableLock()">getTableLock</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getTableName()">getTableName</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#getTransactionManager()">getTransactionManager</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#loadMetadata(org.jdom2.Element)">loadMetadata</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#releaseTableLock()">releaseTableLock</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#saveMetadata(org.jdom2.Element)">saveMetadata</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#setConversionService(org.xflatdb.xflat.convert.ConversionService)">setConversionService</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#setExecutorService(java.util.concurrent.ScheduledExecutorService)">setExecutorService</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#setId(org.jdom2.Element, java.lang.String)">setId</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#setLastActivity(long)">setLastActivity</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#setTransactionManager(org.xflatdb.xflat.db.EngineTransactionManager)">setTransactionManager</a>, <a href="../../../../org/xflatdb/xflat/db/EngineBase.html#writeComplete()">writeComplete</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_org.xflatdb.xflat.db.Engine">
<!--   -->
</a>
<h3>Methods inherited from interface&nbsp;org.xflatdb.xflat.db.<a href="../../../../org/xflatdb/xflat/db/Engine.html" title="interface in org.xflatdb.xflat.db">Engine</a></h3>
<code><a href="../../../../org/xflatdb/xflat/db/Engine.html#deleteAll(org.xflatdb.xflat.query.XPathQuery)">deleteAll</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#deleteRow(java.lang.String)">deleteRow</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#insertRow(java.lang.String, org.jdom2.Element)">insertRow</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#queryTable(org.xflatdb.xflat.query.XPathQuery)">queryTable</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#readRow(java.lang.String)">readRow</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#replaceRow(java.lang.String, org.jdom2.Element)">replaceRow</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#update(java.lang.String, org.xflatdb.xflat.query.XPathUpdate)">update</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#update(org.xflatdb.xflat.query.XPathQuery, org.xflatdb.xflat.query.XPathUpdate)">update</a>, <a href="../../../../org/xflatdb/xflat/db/Engine.html#upsertRow(java.lang.String, org.jdom2.Element)">upsertRow</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="openShards">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>openShards</h4>
<pre>protected&nbsp;java.util.concurrent.ConcurrentMap&lt;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;,<a href="../../../../org/xflatdb/xflat/db/TableMetadata.html" title="class in org.xflatdb.xflat.db">TableMetadata</a>&gt; openShards</pre>
<div class="block">The shards that are currently open and ready to use.</div>
</li>
</ul>
<a name="knownShards">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>knownShards</h4>
<pre>protected&nbsp;java.util.concurrent.ConcurrentMap&lt;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;,java.io.File&gt; knownShards</pre>
<div class="block">The shards that are known to exist on disk.</div>
</li>
</ul>
<a name="directory">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>directory</h4>
<pre>protected&nbsp;java.io.File directory</pre>
<div class="block">The directory managed by this sharded engine.</div>
</li>
</ul>
<a name="config">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>config</h4>
<pre>protected&nbsp;<a href="../../../../org/xflatdb/xflat/ShardsetConfig.html" title="class in org.xflatdb.xflat">ShardsetConfig</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt; config</pre>
<div class="block">The configuration of this sharded table.</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ShardedEngineBase(java.io.File, java.lang.String, org.xflatdb.xflat.ShardsetConfig)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ShardedEngineBase</h4>
<pre>protected&nbsp;ShardedEngineBase(java.io.File&nbsp;file,
                 java.lang.String&nbsp;tableName,
                 <a href="../../../../org/xflatdb/xflat/ShardsetConfig.html" title="class in org.xflatdb.xflat">ShardsetConfig</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;config)</pre>
<div class="block">Creates a new ShardedEngine for the given directory, table name, and configuration</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>file</code> - The directory in which the shards are saved.</dd><dd><code>tableName</code> - The name of the sharded table.</dd><dd><code>config</code> - The sharding configuration.</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getMetadataFactory()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getMetadataFactory</h4>
<pre>protected&nbsp;<a href="../../../../org/xflatdb/xflat/db/TableMetadataFactory.html" title="class in org.xflatdb.xflat.db">TableMetadataFactory</a>&nbsp;getMetadataFactory()</pre>
<div class="block">Gets a metadata factory which can be used to generate <a href="../../../../org/xflatdb/xflat/db/TableMetadata.html" title="class in org.xflatdb.xflat.db"><code>TableMetadata</code></a> objects.
 This allows the engine to spawn additional engines as necessary.
 The metadata factory is set up to read and write metadata from the same
 <code>File</code> given to the <a href="../../../../org/xflatdb/xflat/db/EngineFactory.html#newEngine(java.io.File, java.lang.String, org.xflatdb.xflat.TableConfig)"><code>EngineFactory.newEngine(java.io.File, java.lang.String, org.xflatdb.xflat.TableConfig)</code></a> method,
 so if the engine uses this it must also use that file as a directory.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="setMetadataFactory(org.xflatdb.xflat.db.TableMetadataFactory)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setMetadataFactory</h4>
<pre>protected&nbsp;void&nbsp;setMetadataFactory(<a href="../../../../org/xflatdb/xflat/db/TableMetadataFactory.html" title="class in org.xflatdb.xflat.db">TableMetadataFactory</a>&nbsp;metadataFactory)</pre>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html#getMetadataFactory()"><code>getMetadataFactory()</code></a></dd></dl>
</li>
</ul>
<a name="getRangeForRow(org.jdom2.Element)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getRangeForRow</h4>
<pre>protected&nbsp;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;getRangeForRow(org.jdom2.Element&nbsp;row)</pre>
<div class="block">Gets the interval in which the row should reside, based on the shard property
 selector in the configuration.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>row</code> - The row representing converted data.</dd>
<dt><span class="strong">Returns:</span></dt><dd>The interval in which the row should reside.</dd></dl>
</li>
</ul>
<a name="getInterval(java.lang.Object)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getInterval</h4>
<pre>protected&nbsp;<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;getInterval(java.lang.Object&nbsp;value)</pre>
<div class="block">Gets the interval in which the given selected shard property should reside,
 based on the IntervalProvider given in the configuration.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>value</code> - The shard property selected by the shard property selector in the configuration.</dd>
<dt><span class="strong">Returns:</span></dt><dd>The interval in which the shard property should reside.</dd></dl>
</li>
</ul>
<a name="doWithEngine(org.xflatdb.xflat.query.Interval, org.xflatdb.xflat.db.EngineAction)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>doWithEngine</h4>
<pre>protected&nbsp;&lt;U&gt;&nbsp;U&nbsp;doWithEngine(<a href="../../../../org/xflatdb/xflat/query/Interval.html" title="class in org.xflatdb.xflat.query">Interval</a>&lt;<a href="../../../../org/xflatdb/xflat/db/ShardedEngineBase.html" title="type parameter in ShardedEngineBase">T</a>&gt;&nbsp;range,
                 <a href="../../../../org/xflatdb/xflat/db/EngineAction.html" title="interface in org.xflatdb.xflat.db">EngineAction</a>&lt;U&gt;&nbsp;action)</pre>
<div class="block">Performs an action with the appropriate engine for the given shard interval.
 The shard interval must be one that is provided by the IntervalProvider
 for this sharded engine, which maps to a shard file on disk.</div>
<dl><dt><span class="strong">Type Parameters:</span></dt><dd><code>U</code> - The generic type of the value to return.</dd><dt><span class="strong">Parameters:</span></dt><dd><code>range</code> - The shard interval mapping to a shard file on disk.</dd><dd><code>action</code> - The action to perform once the engine is provided.</dd>
<dt><span class="strong">Returns:</span></dt><dd>The value returned by the action.</dd></dl>
</li>
</ul>
<a name="updateTask()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateTask</h4>
<pre>protected&nbsp;void&nbsp;updateTask()</pre>
<div class="block">Executed by the recurring update task every 500 ms in order to clean up
 the shardset and spin down any inactive shards.</div>
</li>
</ul>
<a name="hasUncomittedData()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>hasUncomittedData</h4>
<pre>protected&nbsp;boolean&nbsp;hasUncomittedData()</pre>
<div class="block">Returns true if any of the individual shards have uncommitted data.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#hasUncomittedData()">hasUncomittedData</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
<dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="revert(long, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>revert</h4>
<pre>public&nbsp;void&nbsp;revert(long&nbsp;txId,
          boolean&nbsp;isRecovering)</pre>
<div class="block">Reverts the given transaction.  If not recovering, this does nothing,
 since the individual shards will have been bound to the transaction themselves.<br/>
 If recovering, every shard in the shardset will be opened and the transaction 
 will be reverted in that shard.</div>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#revert(long, boolean)">revert</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>txId</code> - The ID of the (potentially partially-committed) transaction to revert.</dd><dd><code>isRecovering</code> - true if this was called during a recovery operation on startup.</dd></dl>
</li>
</ul>
<a name="spinUp()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>spinUp</h4>
<pre>protected&nbsp;boolean&nbsp;spinUp()</pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#spinUp()">EngineBase</a></code></strong></div>
<div class="block">Initializes the engine and instructs it to begin acquiring the resources
 necessary to function.  At this point the engine may begin to respond to
 read-only requests, but any write requests MUST block until {@link #beginOperations() )
 is called.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#spinUp()">spinUp</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
</dl>
</li>
</ul>
<a name="beginOperations()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>beginOperations</h4>
<pre>protected&nbsp;boolean&nbsp;beginOperations()</pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#beginOperations()">EngineBase</a></code></strong></div>
<div class="block">Instructs the engine to begin full read/write operations.  At this point this
 engine has full control over the data files.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#beginOperations()">beginOperations</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
</dl>
</li>
</ul>
<a name="spinDown(org.xflatdb.xflat.db.EngineBase.SpinDownEventHandler)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>spinDown</h4>
<pre>protected&nbsp;boolean&nbsp;spinDown(<a href="../../../../org/xflatdb/xflat/db/EngineBase.SpinDownEventHandler.html" title="interface in org.xflatdb.xflat.db">EngineBase.SpinDownEventHandler</a>&nbsp;completionEventHandler)</pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#spinDown(org.xflatdb.xflat.db.EngineBase.SpinDownEventHandler)">EngineBase</a></code></strong></div>
<div class="block">Instructs this Engine to wrap up its operations in preparation for being
 switched out.  The engine must be set to read-only mode (write operations
 should throw an exception).  The engine can stay alive until its outstanding
 cursors are closed, but must allow concurrent reads of the file.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#spinDown(org.xflatdb.xflat.db.EngineBase.SpinDownEventHandler)">spinDown</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
<dt><span class="strong">Parameters:</span></dt><dd><code>completionEventHandler</code> - An event handler that is notified when
 the Engine has finished spinning down.</dd></dl>
</li>
</ul>
<a name="isSpunDown()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isSpunDown</h4>
<pre>protected&nbsp;boolean&nbsp;isSpunDown()</pre>
<div class="block">Invoked in a synchronized context to see if the sharded engine is 
 fully spun down.  Default implementation checks whether the spinning
 down engines have all spun down.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="forceSpinDown()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>forceSpinDown</h4>
<pre>protected&nbsp;boolean&nbsp;forceSpinDown()</pre>
<div class="block"><strong>Description copied from class:&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#forceSpinDown()">EngineBase</a></code></strong></div>
<div class="block">Forces this engine to immediately release all resources, even if there are
 still outstanding cursors or uncommitted data.  Cursors that continue iterating will throw an
 exception that indicates the engine has spun down.  This will be called after a normal
 spin down, or in case of some kind of error to reclaim resources.</div>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html#forceSpinDown()">forceSpinDown</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/xflatdb/xflat/db/EngineBase.html" title="class in org.xflatdb.xflat.db">EngineBase</a></code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ShardedEngineBase.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/xflatdb/xflat/db/IntegerIdGenerator.html" title="class in org.xflatdb.xflat.db"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/xflatdb/xflat/db/TableBase.html" title="class in org.xflatdb.xflat.db"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/xflatdb/xflat/db/ShardedEngineBase.html" target="_top">Frames</a></li>
<li><a href="ShardedEngineBase.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_classes_inherited_from_class_org.xflatdb.xflat.db.EngineBase">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
