<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Xflat Examples</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
  <div class="wrapper">
	<header>
        <h1 class="header">Xflat</h1>
        <p class="header">A simple but powerful embedded XML object DB.</p>

        <ul>
		  <li class="download"><a class="buttons" href="https://sourceforge.net/projects/xflatdb/">Download JAR</a></li>
          <li class="download"><a class="buttons" href="https://github.com/gburgett/XFlat/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/gburgett/XFlat/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/gburgett/XFlat">View On GitHub</a></li>
        </ul>
		
		<p>
			<a href="index.html">Home</a><br/>			
			<a href="javadoc/1.0.0/index.html">Javadoc</a>
		</p>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/gburgett">Gordon Burgett</a></p>
		<img src="images/gordon_dot_burgett.png" id="em" />


      </header>
    <section>
  <h3>Examples</h3>

  
<p>Insert an instance of <code>Foo</code> into the table "Foo" stored in "myDataDirectory/Foo.xml".</p>

<div class="highlight"><pre><span class="n">XFlatDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XFlatDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"myDataDirectory"</span><span class="o">));</span>
<span class="c1">//initialize with default config</span>
<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>

<span class="n">Foo</span> <span class="n">myFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myFoo</span><span class="o">);</span>  <span class="c1">//inserts with unique automatically-generated ID</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Stored foo in table Foo with ID "</span> <span class="o">+</span> <span class="n">myFoo</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

<span class="n">Foo</span> <span class="n">myFoo2</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">myFoo</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="c1">//myFoo2 is a new instance with the same data as myFoo</span>
</pre></div>

  
<p>Insert an instance of <code>Foo</code> with a pre-set ID</p>

<div class="highlight"><pre><span class="n">XFlatDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XFlatDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"myDataDirectory"</span><span class="o">));</span>
<span class="c1">//initialize with default config</span>
<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>

<span class="n">Foo</span> <span class="n">myFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="n">myFoo</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="s">"SomeUniqueId"</span><span class="o">);</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myFoo</span><span class="o">);</span>  
<span class="c1">//beware DuplicateKeyException if fooTable already has a row with that ID</span>

<span class="n">Foo</span> <span class="n">myFoo2</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="s">"SomeUniqueId"</span><span class="o">);</span>
<span class="c1">//myFoo2 is a new instance with the same data as myFoo</span>
</pre></div>

<p>Insert an instance of <code>Bar</code> into the "Foo" table - this works as long as their ID types are both compatible
with the ID generator assigned to "Foo".</p>

<div class="highlight"><pre><span class="n">Foo</span> <span class="n">myFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myFoo</span><span class="o">);</span>

<span class="n">Bar</span> <span class="n">myBar</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Bar</span><span class="o">();</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">barTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Bar</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"Foo"</span><span class="o">);</span>
<span class="n">barTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myBar</span><span class="o">);</span>

<span class="n">Bar</span> <span class="n">myBar2</span> <span class="o">=</span> <span class="n">barTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">myBar</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>

<span class="n">Bar</span> <span class="n">thisIsFooData</span> <span class="o">=</span> <span class="n">barTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">myFoo</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="c1">//attempts to deserialize myFoo's data as a Bar, might throw ConversionException.</span>

<span class="n">Element</span> <span class="n">myFooData</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Element</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"Foo"</span><span class="o">).</span><span class="na">find</span><span class="o">(</span><span class="n">myFoo</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="c1">//myFooData is the XML serialized representation of myFoo.</span>
</pre></div>

<p>Use a custom ID generator for the "Foo" table - the custom class must have a no-args constructor and extend <code>IdGenerator</code>.</p>

<div class="highlight"><pre><span class="n">XFlatDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XFlatDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"myDataDirectory"</span><span class="o">));</span>
<span class="c1">//do config before calling initialize</span>
<span class="n">db</span><span class="o">.</span><span class="na">configureTable</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">,</span> <span class="n">TableConfig</span><span class="o">.</span><span class="na">defaultConfig</span>
    <span class="o">.</span><span class="na">setIdGenerator</span><span class="o">(</span><span class="n">MyCustomIdGenerator</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>

<span class="n">Foo</span> <span class="n">myFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myFoo</span><span class="o">);</span>
<span class="c1">//myFoo now has the ID generated by MyCustomIdGenerator</span>
</pre></div>

<p>Use custom converters to map <code>Foo</code> objects to XML.  If this is done for every POJO that is a root of a row,
then the JAXB mapper will never be invoked and the JAXB jars do not need to be on the classpath.</p>

<div class="highlight"><pre><span class="n">XFlatDatabase</span> <span class="n">db</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XFlatDatabase</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">"myDataDirectory"</span><span class="o">));</span>
<span class="c1">//do config before calling initialize</span>
<span class="n">db</span><span class="o">.</span><span class="na">getConversionService</span><span class="o">().</span><span class="na">addConverter</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Element</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">FooToElementConverter</span><span class="o">());</span>
<span class="n">db</span><span class="o">.</span><span class="na">getConversionService</span><span class="o">().</span><span class="na">addConverter</span><span class="o">(</span><span class="n">Element</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="k">new</span> <span class="n">ElementToFooConverter</span><span class="o">());</span>

<span class="n">db</span><span class="o">.</span><span class="na">initialize</span><span class="o">();</span>

<span class="n">Foo</span> <span class="n">myFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
<span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="n">myFoo</span><span class="o">);</span>
<span class="c1">//myFoo was converted to XML using the FooToElementConverter</span>

<span class="n">Foo</span> <span class="n">myFoo2</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">myFoo</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="c1">//myFoo2 was converted from XML using the ElementToFooConverter</span>
</pre></div>

<p>Query the table for the first <code>Foo</code> which has fooInt &gt; 17</p>

<div class="highlight"><pre><span class="c1">//XPath expressions must be compiled, consider caching often-used expressions</span>
<span class="n">XPathExpression</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">expression</span> <span class="o">=</span> <span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"foo/fooInt"</span><span class="o">);</span>
<span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">gte</span><span class="o">(</span><span class="n">expression</span><span class="o">,</span> <span class="mi">17</span><span class="o">);</span>

<span class="n">Foo</span> <span class="n">found</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">found</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Could not find a Foo with fooInt &gt; 17"</span><span class="o">);</span>
<span class="k">else</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Found foo "</span> <span class="o">+</span> <span class="n">found</span> <span class="o">+</span> <span class="s">" with fooInt "</span> <span class="o">+</span> <span class="n">found</span><span class="o">.</span><span class="na">getFooInt</span><span class="o">());</span>
</pre></div>

<p>Query the table for all <code>Bar</code> with barStr == "Some String" (Bar has the barStr property mapped to an attribute
using <code>@XmlAttribute</code>).</p>

<div class="highlight"><pre><span class="n">XPathExpression</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">expression</span> <span class="o">=</span> <span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"bar/@barStr"</span><span class="o">);</span>
<span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">expression</span><span class="o">,</span> <span class="s">"Some String"</span><span class="o">);</span>

<span class="n">Cursor</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">barCursor</span> <span class="o">=</span> <span class="n">barTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
<span class="k">try</span><span class="o">{</span>

    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Bar</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">barCursor</span><span class="o">){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Found bar "</span> <span class="o">+</span> <span class="n">bar</span><span class="o">);</span>
        <span class="n">i</span><span class="o">++;</span>
    <span class="o">}</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Found "</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="s">" Bars"</span><span class="o">);</span>
<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
    <span class="c1">//Always close cursors!</span>
    <span class="n">barCursor</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<p>Atomically update each <code>Bar</code> with barStr == "Some String" to set barDouble to 17.4</p>

<div class="highlight"><pre><span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"bar/@barStr"</span><span class="o">),</span> <span class="s">"Some String"</span><span class="o">);</span>
<span class="n">XpathUpdate</span> <span class="n">update</span> <span class="o">=</span> <span class="n">XpathUpdate</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"bar/barDouble"</span><span class="o">),</span> <span class="mf">17.4</span><span class="o">);</span>

<span class="kt">int</span> <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">barTable</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">update</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">rowsUpdated</span> <span class="o">+</span> <span class="s">" rows were updated"</span><span class="o">);</span>
<span class="n">Bar</span> <span class="n">bar</span> <span class="o">=</span> <span class="n">barTable</span><span class="o">.</span><span class="na">findOne</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"updated bar has barDouble "</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="na">getBarDouble</span><span class="o">());</span>
</pre></div>

<p>An example of a table persisted to an XML file:</p>

<div class="highlight"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;db:table</span> <span class="na">xmlns:db=</span><span class="s">"http://www.xflatdb.org/xflat/db"</span> <span class="na">db:name=</span><span class="s">"Foo"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;db:row</span> <span class="na">db:id=</span><span class="s">"627070d8-0b9b-4154-aa01-eafd0a388c54"</span><span class="nt"> <span class="na">db:tx=</span><span class="s">"89085479315505152"</span> <span class="na">db:commit=</span><span class="s">"89085479315505152"</span>&gt;</span>
        <span class="nt">&lt;foo</span> <span class="na">db:id=</span><span class="s">"627070d8-0b9b-4154-aa01-eafd0a388c54"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;fooInt&gt;</span>26<span class="nt">&lt;/fooInt&gt;</span>
        <span class="nt">&lt;/foo&gt;</span>
    <span class="nt">&lt;/db:row&gt;</span>
<span class="nt">&lt;/db:table&gt;</span>
</pre></div>

<h4>
<a name="transactions" class="anchor" href="#transactions"><span class="mini-icon mini-icon-link"></span></a>Transactions</h4>

<p>Open a transaction and commit multiple updates atomically</p>

<div class="highlight"><pre><span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="k">try</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTransactionManager</span><span class="o">().</span><span class="na">openTransaction</span><span class="o">()){</span>

    <span class="n">Foo</span> <span class="n">newFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
    <span class="n">newFoo</span><span class="o">.</span><span class="na">setFooInt</span><span class="o">(</span><span class="mi">17</span><span class="o">);</span>

    <span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="n">newFoo</span><span class="o">);</span>

    <span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"foo/fooInt"</span><span class="o">),</span> <span class="mi">34</span><span class="o">);</span>
    <span class="n">XpathUpdate</span> <span class="n">update</span> <span class="o">=</span> <span class="n">XpathUpdate</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"foo/fooString"</span><span class="o">),</span> <span class="s">"updated text"</span><span class="o">);</span>

    <span class="n">fooTable</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">update</span><span class="o">);</span>

    <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>    <span class="c1">//can throw TransactionException</span>
<span class="o">}</span>
</pre></div>

<p>Open a read-only transaction that is automatically reverted when closed; the transaction reads a snapshot of the committed data at the time the transaction was opened.</p>

<div class="highlight"><pre><span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

<span class="k">try</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTransactionManager</span><span class="o">().</span><span class="na">openTransaction</span><span class="o">(</span><span class="k">new</span> <span class="n">TransactionOptions</span><span class="o">().</span><span class="na">withReadOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">))){</span>

    <span class="n">Foo</span> <span class="n">foo1</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="s">"1"</span><span class="o">);</span>

    <span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">gt</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"foo/fooInt"</span><span class="o">),</span> <span class="mi">21</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">moreFoos</span> <span class="o">=</span> <span class="n">fooTable</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">query</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>

<p>Open and commit a transaction spanning multiple tables</p>

<div class="highlight"><pre><span class="n">Table</span><span class="o">&lt;</span><span class="n">Foo</span><span class="o">&gt;</span> <span class="n">fooTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Foo</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"Table_1"</span><span class="o">);</span>
<span class="n">Table</span><span class="o">&lt;</span><span class="n">Bar</span><span class="o">&gt;</span> <span class="n">barTable</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTable</span><span class="o">(</span><span class="n">Bar</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"Table_2"</span><span class="o">);</span>

<span class="k">try</span><span class="o">(</span><span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="na">getTransactionManager</span><span class="o">().</span><span class="na">openTransaction</span><span class="o">()){</span>

    <span class="n">Foo</span> <span class="n">newFoo</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Foo</span><span class="o">();</span>
    <span class="n">newFoo</span><span class="o">.</span><span class="na">setFooInt</span><span class="o">(</span><span class="mi">17</span><span class="o">);</span>

    <span class="n">fooTable</span><span class="o">.</span><span class="na">insert</span><span class="o">(</span><span class="s">"1"</span><span class="o">,</span> <span class="n">newFoo</span><span class="o">);</span>

    <span class="n">XpathQuery</span> <span class="n">query</span> <span class="o">=</span> <span class="n">XpathQuery</span><span class="o">.</span><span class="na">lte</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"bar/barDouble"</span><span class="o">),</span> <span class="mf">34.1</span><span class="o">);</span>
    <span class="n">Baz</span> <span class="n">newBaz</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Baz</span><span class="o">();</span>
    <span class="n">newBaz</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="s">"some data"</span><span class="o">);</span>
    <span class="n">XpathUpdate</span> <span class="n">update</span> <span class="o">=</span> <span class="n">XpathUpdate</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">XPathFactory</span><span class="o">.</span><span class="na">instance</span><span class="o">().</span><span class="na">compile</span><span class="o">(</span><span class="s">"bar/barBaz"</span><span class="o">),</span> <span class="n">newBaz</span><span class="o">);</span>

    <span class="n">barTable</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">update</span><span class="o">);</span>

    <span class="c1">//commits to both Table_1 and Table_2</span>
    <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>    <span class="c1">//can throw TransactionException</span>
<span class="o">}</span>
</pre></div>
	
	</section>

	<footer>
		<p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
	</footer>
	</div>
	</body>
</html>