---
---
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Xflat Examples</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
  <div class="wrapper">
	<header>
        <h1 class="header">Xflat</h1>
        <p class="header">A simple but powerful embedded XML object DB.</p>

        <ul>
		 <li><a class="buttons" href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.xflatdb%22%20AND%20a%3A%22xflat%22">Maven</a></li>		 
		 <li class="download"><a class="buttons" href="https://sourceforge.net/projects/xflatdb/">Download</a></li>
          <li><a class="buttons github" href="https://github.com/gburgett/XFlat">View On GitHub</a></li>
        </ul>
		
		<p>
			<a href="index.html">Home</a><br/>
			<a href="getting_started.html">Getting Started</a><br/>
			<a href="javadoc/0.9/index.html">Javadoc</a>
		</p>
		
		<img src="https://travis-ci.org/gburgett/XFlat.png?branch=master,release"/>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/gburgett">Gordon Burgett</a></p>
		<img src="images/gordon_dot_burgett.png" id="em" />


      </header>
    <section>
  <h3>Examples</h3>

  
<p>Insert an instance of <code>Foo</code> into the table "Foo" stored in "myDataDirectory/Foo.xml".</p>

{% highlight java %}
//initialize with default config
Database myDatabase = XFlatDatabase.Build(dir).create();

Foo myFoo = new Foo();
Table<Foo> fooTable = db.getTable(Foo.class);

//inserts with unique automatically-generated ID
fooTable.insert(myFoo);
System.out.println("Stored foo in table Foo with ID " + myFoo.getId());

Foo myFoo2 = fooTable.find(myFoo.getId());
//myFoo2 is a new instance with the same data as myFoo
{% endhighlight %}
  
<p>Insert an instance of <code>Foo</code> with a pre-set ID</p>

{% highlight java %}
//initialize with default config
Database myDatabase = XFlatDatabase.Build(dir).create();

Foo myFoo = new Foo();
myFoo.setId("SomeUniqueId");
Table<Foo> fooTable = db.getTable(Foo.class);
fooTable.insert(myFoo);
//beware DuplicateKeyException if fooTable already has a row with that ID

Foo myFoo2 = fooTable.find("someUniqueId");
//myFoo2 is a new instance with the same data as myFoo
{% endhighlight %}


<p>Insert an instance of <code>Bar</code> into the "Foo" table - this works as long as their ID types are both compatible
with the ID generator assigned to "Foo".</p>

{% highlight java %}
Foo myFoo = new Foo();
Table<Foo> fooTable = db.getTable(Foo.class);
fooTable.insert(myFoo);

Bar myBar = new Bar();
Table<Bar> barTable = db.getTable(Bar.class, "Foo");
barTable.insert(myBar);

Bar myBar2 = barTable.find(myBar.getId());

Bar thisIsFooData = barTable.find(myFoo.getId());
//attempts to deserialize myFoo's data as a Bar, might throw ConversionException.

Element myFooData = db.getTable(Element.class, "Foo").find(myFoo.getId());
//myFooData is the XML serialized representation of myFoo.
{% endhighlight %}

<p>Use a custom ID generator for the "Foo" table - the custom class must have a no-args constructor and extend <code>IdGenerator</code>.</p>

{% highlight java %}
Database myDatabase = XFlatDatabase.Build(dir)
		.withTableConfig("timestampedData",			
			TableConfig.DEFAULT.withIdGenerator(TimestampIdGenerator.class)
		.create();
		
Foo myFoo = new Foo();
Table<Foo> fooTable = db.getTable(Foo.class);
fooTable.insert(myFoo);
//myFoo now has a timestamp for it's ID
{% endhighlight %}

<p>Use custom converters to map <code>Foo</code> objects to XML.  If this is done for every POJO that is a root of a row,
then the JAXB mapper will never be invoked and the JAXB jars do not need to be on the classpath.</p>

{% highlight java %}
//initialize with default config
Database myDatabase = XFlatDatabase.Build(dir).create();
db.getConversionService().addConverter(Foo.class, Element.class, new FooToElementConverter());
db.getConversionService().addConverter(Element.class, Foo.class, new ElementToFooConverter());

Foo myFoo = new Foo();
Table<Foo> fooTable = db.getTable(Foo.class);
fooTable.insert(myFoo);
//myFoo was converted to XML using the FooToElementConverter

Foo myFoo2 = fooTable.find(myFoo.getId());
//myFoo2 was converted from XML using the ElementToFooConverter
{% endhighlight %}

<p>Query the table for the first <code>Foo</code> which has fooInt &gt; 17</p>

{% highlight java %}
//XPath expressions must be compiled, consider caching often-used expressions
XPathExpression<Object> expression = XPathFactory.instance().compile("foo/fooInt");
XpathQuery query = XpathQuery.gte(expression, 17);

Foo found = fooTable.findOne(query);
if(found == null)
    System.out.println("Could not find a Foo with fooInt > 17");
else
    System.out.println("Found foo " + found + " with fooInt " + found.getFooInt());
{% endhighlight %}

<p>Query the table for all <code>Bar</code> with barStr == "Some String" (Bar has the barStr property mapped to an attribute
using <code>@XmlAttribute</code>).</p>

{% highlight java %}
XPathExpression<Object> expression = XPathFactory.instance().compile("bar/@barStr");
XpathQuery query = XpathQuery.eq(expression, "Some String");

Cursor<Bar> barCursor = barTable.find(query);
try{

    int i = 0;
    for(Bar bar : barCursor){
        System.out.println("Found bar " + bar);
        i++;
    }
    System.out.println("Found " + i + " Bars");
}finally{
    //Always close cursors!
    barCursor.close();
}
{% endhighlight %}

<p>Atomically update each <code>Bar</code> with barStr == "Some String" to set barDouble to 17.4</p>

{% highlight java %}
XpathQuery query = XpathQuery.eq(XPathFactory.instance().compile("bar/@barStr"), "Some String");
XpathUpdate update = XpathUpdate.set(XPathFactory.instance().compile("bar/barDouble"), 17.4);

int rowsUpdated = barTable.update(query, update);

System.out.println(rowsUpdated + " rows were updated");
Bar bar = barTable.findOne(query);
System.out.println("updated bar has barDouble " + bar.getBarDouble());
{% endhighlight %}

<p>An example of a table persisted to an XML file:</p>

{% highlight xml %}
<?xml version="1.0" encoding="UTF-8"?>
<db:table xmlns:db="http://www.xflatdb.org/xflat/db" db:name="Foo">
    <db:row db:id="627070d8-0b9b-4154-aa01-eafd0a388c54" db:tx="89085479315505152" db:commit="89085479315505152">
        <foo db:id="627070d8-0b9b-4154-aa01-eafd0a388c54">
            <fooInt>26</fooInt>
        </foo>
    </db:row>
</db:table>
{% endhighlight %}

<h4>
<a name="transactions" class="anchor" href="#transactions"><span class="mini-icon mini-icon-link"></span></a>Transactions</h4>

<p>Open a transaction and commit multiple updates atomically</p>

{% highlight java %}
Table<Foo> fooTable = db.getTable(Foo.class);

try(Transaction tx = db.getTransactionManager().openTransaction()){

    Foo newFoo = new Foo();
    newFoo.setFooInt(17);

    fooTable.insert("1", newFoo);

    XpathQuery query = XpathQuery.eq(XPathFactory.instance().compile("foo/fooInt"), 34);
    XpathUpdate update = XpathUpdate.set(XPathFactory.instance().compile("foo/fooString"), "updated text");

    fooTable.update(query, update);

    tx.commit();    //can throw TransactionException
}
{% endhighlight %}

<p>Open a read-only transaction that is automatically reverted when closed; the transaction reads a snapshot of the committed data at the time the transaction was opened.</p>

{% highlight java %}
Table<Foo> fooTable = db.getTable(Foo.class);

try(Transaction tx = db.getTransactionManager().openTransaction(new TransactionOptions().withReadOnly(true))){

    Foo foo1 = fooTable.find("1");

    XpathQuery query = XpathQuery.gt(XPathFactory.instance().compile("foo/fooInt"), 21);
    List<Foo> moreFoos = fooTable.findAll(query);
}
{% endhighlight %}

<p>Open and commit a transaction spanning multiple tables</p>

{% highlight java %}
Table<Foo> fooTable = db.getTable(Foo.class, "Table_1");
Table<Bar> barTable = db.getTable(Bar.class, "Table_2");

try(Transaction tx = db.getTransactionManager().openTransaction()){

    Foo newFoo = new Foo();
    newFoo.setFooInt(17);

    fooTable.insert("1", newFoo);

    XpathQuery query = XpathQuery.lte(XPathFactory.instance().compile("bar/barDouble"), 34.1);
    Baz newBaz = new Baz();
    newBaz.setData("some data");
    XpathUpdate update = XpathUpdate.set(XPathFactory.instance().compile("bar/barBaz"), newBaz);

    barTable.update(query, update);

    //commits to both Table_1 and Table_2
    tx.commit();    //can throw TransactionException
}
{% endhighlight %}

	</section>

	<footer>
		<p><small>Hosted on <a href="https://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
	</footer>
	</div>
	</body>
</html>